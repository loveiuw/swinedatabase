(function(a){var b,c,d;a.extend({roundaboutShapes:{def:"lazySusan",lazySusan:function(f,e,g){return{x:Math.sin(f+e),y:(Math.sin(f+3*Math.PI/2+e)/8)*g,z:(Math.cos(f+e)+1)/2,scale:(Math.sin(f+Math.PI/2+e)/2)+0.5}}}});b={bearing:0,tilt:0,minZ:100,maxZ:280,minOpacity:0.4,maxOpacity:1,minScale:0.4,maxScale:1,duration:600,btnNext:null,btnNextCallback:function(){},btnPrev:null,btnPrevCallback:function(){},btnToggleAutoplay:null,btnStartAutoplay:null,btnStopAutoplay:null,easing:"swing",clickToFocus:true,clickToFocusCallback:function(){},focusBearing:0,shape:"lazySusan",debug:false,childSelector:"li",startingChild:null,reflect:false,floatComparisonThreshold:0.001,autoplay:false,autoplayDuration:1000,autoplayPauseOnHover:false,autoplayCallback:function(){},autoplayInitialDelay:0,enableDrag:false,dropDuration:600,dropEasing:"swing",dropAnimateTo:"nearest",dropCallback:function(){},dragAxis:"x",dragFactor:4,triggerFocusEvents:true,triggerBlurEvents:true,responsive:false};c={autoplayInterval:null,autoplayIsRunning:false,autoplayStartTimeout:null,animating:false,childInFocus:-1,touchMoveStartPosition:null,stopAnimation:false,lastAnimationStep:false};d={init:function(g,e,h){var i,f=(new Date()).getTime();g=(typeof g==="object")?g:{};e=(a.isFunction(e))?e:function(){};e=(a.isFunction(g))?g:e;i=a.extend({},b,g,c);return this.each(function(){var m=a(this),j=m.children(i.childSelector).length,l=360/j,o=(i.startingChild&&i.startingChild>(j-1))?(j-1):i.startingChild,n=(i.startingChild===null)?i.bearing:360-(o*l),k=(m.css("position")!=="static")?m.css("position"):"relative";m.css({padding:0,position:k}).addClass("roundabout-holder").data("roundabout",a.extend({},i,{startingChild:o,bearing:n,oppositeOfFocusBearing:d.normalize.apply(null,[i.focusBearing-180]),dragBearing:n,period:l}));if(h){m.unbind(".roundabout").children(i.childSelector).unbind(".roundabout")}else{if(i.responsive){a(window).bind("resize",function(){d.stopAutoplay.apply(m);d.relayoutChildren.apply(m)})}}if(i.clickToFocus){m.children(i.childSelector).each(function(p){a(this).bind("click.roundabout",function(){var q=d.getPlacement.apply(m,[p]);if(!d.isInFocus.apply(m,[q])){d.stopAnimation.apply(a(this));if(!m.data("roundabout").animating){d.animateBearingToFocus.apply(m,[q,m.data("roundabout").clickToFocusCallback])}return false}})})}if(i.btnNext){a(i.btnNext).bind("click.roundabout",function(){if(!m.data("roundabout").animating){d.animateToNextChild.apply(m,[m.data("roundabout").btnNextCallback])}return false})}if(i.btnPrev){a(i.btnPrev).bind("click.roundabout",function(){d.animateToPreviousChild.apply(m,[m.data("roundabout").btnPrevCallback]);return false})}if(i.btnToggleAutoplay){a(i.btnToggleAutoplay).bind("click.roundabout",function(){d.toggleAutoplay.apply(m);return false})}if(i.btnStartAutoplay){a(i.btnStartAutoplay).bind("click.roundabout",function(){d.startAutoplay.apply(m);return false})}if(i.btnStopAutoplay){a(i.btnStopAutoplay).bind("click.roundabout",function(){d.stopAutoplay.apply(m);return false})}if(i.autoplayPauseOnHover){m.bind("mouseenter.roundabout.autoplay",function(){d.stopAutoplay.apply(m,[true])}).bind("mouseleave.roundabout.autoplay",function(){d.startAutoplay.apply(m)})}if(i.enableDrag){if(!a.isFunction(m.drag)){if(i.debug){alert("You do not have the drag plugin loaded.")}}else{if(!a.isFunction(m.drop)){if(i.debug){alert("You do not have the drop plugin loaded.")}}else{m.drag(function(r,s){var p=m.data("roundabout"),q=(p.dragAxis.toLowerCase()==="x")?"deltaX":"deltaY";d.stopAnimation.apply(m);d.setBearing.apply(m,[p.dragBearing+s[q]/p.dragFactor])}).drop(function(q){var p=m.data("roundabout"),r=d.getAnimateToMethod(p.dropAnimateTo);d.allowAnimation.apply(m);d[r].apply(m,[p.dropDuration,p.dropEasing,p.dropCallback]);p.dragBearing=p.period*d.getNearestChild.apply(m)})}}m.each(function(){var q=a(this).get(0),p=a(this).data("roundabout"),s=(p.dragAxis.toLowerCase()==="x")?"pageX":"pageY",r=d.getAnimateToMethod(p.dropAnimateTo);if(q.addEventListener){q.addEventListener("touchstart",function(t){p.touchMoveStartPosition=t.touches[0][s]},false);q.addEventListener("touchmove",function(u){var t=(u.touches[0][s]-p.touchMoveStartPosition)/p.dragFactor;u.preventDefault();d.stopAnimation.apply(a(this));d.setBearing.apply(a(this),[p.dragBearing+t])},false);q.addEventListener("touchend",function(t){t.preventDefault();d.allowAnimation.apply(a(this));r=d.getAnimateToMethod(p.dropAnimateTo);d[r].apply(a(this),[p.dropDuration,p.dropEasing,p.dropCallback]);p.dragBearing=p.period*d.getNearestChild.apply(a(this))},false)}})}d.initChildren.apply(m,[e,h])})},initChildren:function(e,g){var h=a(this),f=h.data("roundabout");e=e||function(){};h.children(f.childSelector).each(function(k){var n,m,l,j=d.getPlacement.apply(h,[k]);if(g&&a(this).data("roundabout")){n=a(this).data("roundabout").startWidth;m=a(this).data("roundabout").startHeight;l=a(this).data("roundabout").startFontSize}a(this).addClass("roundabout-moveable-item").css("position","absolute");a(this).data("roundabout",{startWidth:n||a(this).width(),startHeight:m||a(this).height(),startFontSize:l||parseInt(a(this).css("font-size"),10),degrees:j,backDegrees:d.normalize.apply(null,[j-180]),childNumber:k,currentScale:1,parent:h})});d.updateChildren.apply(h);if(f.autoplay){f.autoplayStartTimeout=setTimeout(function(){d.startAutoplay.apply(h)},f.autoplayInitialDelay)}h.trigger("ready");e.apply(h);return h},updateChildren:function(){return this.each(function(){var h=a(this),e=h.data("roundabout"),g=-1,f={bearing:e.bearing,tilt:e.tilt,stage:{width:Math.floor(a(this).width()*0.9),height:Math.floor(a(this).height()*0.9)},animating:e.animating,inFocus:e.childInFocus,focusBearingRadian:d.degToRad.apply(null,[e.focusBearing]),shape:a.roundaboutShapes[e.shape]||a.roundaboutShapes[a.roundaboutShapes.def]};f.midStage={width:f.stage.width/2,height:f.stage.height/2};f.nudge={width:f.midStage.width+(f.stage.width*0.05),height:f.midStage.height+(f.stage.height*0.05)};f.zValues={min:e.minZ,max:e.maxZ,diff:e.maxZ-e.minZ};f.opacity={min:e.minOpacity,max:e.maxOpacity,diff:e.maxOpacity-e.minOpacity};f.scale={min:e.minScale,max:e.maxScale,diff:e.maxScale-e.minScale};h.children(e.childSelector).each(function(j){if(d.updateChild.apply(h,[a(this),f,j,function(){a(this).trigger("ready")}])&&(!f.animating||e.lastAnimationStep)){g=j;a(this).addClass("roundabout-in-focus")}else{a(this).removeClass("roundabout-in-focus")}});if(g!==f.inFocus){if(e.triggerBlurEvents){h.children(e.childSelector).eq(f.inFocus).trigger("blur")}e.childInFocus=g;if(e.triggerFocusEvents&&g!==-1){h.children(e.childSelector).eq(g).trigger("focus")}}h.trigger("childrenUpdated")})},updateChild:function(g,k,h,e){var j,n=this,f=a(g),i=f.data("roundabout"),l=[],m=d.degToRad.apply(null,[(360-i.degrees)+k.bearing]);e=e||function(){};m=d.normalizeRad.apply(null,[m]);j=k.shape(m,k.focusBearingRadian,k.tilt);j.scale=(j.scale>1)?1:j.scale;j.adjustedScale=(k.scale.min+(k.scale.diff*j.scale)).toFixed(4);j.width=(j.adjustedScale*i.startWidth).toFixed(4);j.height=(j.adjustedScale*i.startHeight).toFixed(4);f.css({left:((j.x*k.midStage.width+k.nudge.width)-j.width/2).toFixed(0)+"px",top:((j.y*k.midStage.height+k.nudge.height)-j.height/2).toFixed(0)+"px",width:j.width+"px",height:j.height+"px",opacity:(k.opacity.min+(k.opacity.diff*j.scale)).toFixed(2),zIndex:Math.round(k.zValues.min+(k.zValues.diff*j.z)),fontSize:(j.adjustedScale*i.startFontSize).toFixed(1)+"px"});i.currentScale=j.adjustedScale;if(n.data("roundabout").debug){l.push('<div style="font-weight: normal; font-size: 10px; padding: 2px; width: '+f.css("width")+'; background-color: #ffc;">');l.push('<strong style="font-size: 12px; white-space: nowrap;">Child '+h+"</strong><br />");l.push("<strong>left:</strong> "+f.css("left")+"<br />");l.push("<strong>top:</strong> "+f.css("top")+"<br />");l.push("<strong>width:</strong> "+f.css("width")+"<br />");l.push("<strong>opacity:</strong> "+f.css("opacity")+"<br />");l.push("<strong>height:</strong> "+f.css("height")+"<br />");l.push("<strong>z-index:</strong> "+f.css("z-index")+"<br />");l.push("<strong>font-size:</strong> "+f.css("font-size")+"<br />");l.push("<strong>scale:</strong> "+f.data("roundabout").currentScale);l.push("</div>");f.html(l.join(""))}f.trigger("reposition");e.apply(n);return d.isInFocus.apply(n,[i.degrees])},setBearing:function(e,f){f=f||function(){};e=d.normalize.apply(null,[e]);this.each(function(){var h,j,i,l=a(this),g=l.data("roundabout"),k=g.bearing;g.bearing=e;l.trigger("bearingSet");d.updateChildren.apply(l);h=Math.abs(k-e);if(!g.animating||h>180){return}h=Math.abs(k-e);l.children(g.childSelector).each(function(n){var m;if(d.isChildBackDegreesBetween.apply(a(this),[e,k])){m=(k>e)?"Clockwise":"Counterclockwise";a(this).trigger("move"+m+"ThroughBack")}})});f.apply(this);return this},adjustBearing:function(f,e){e=e||function(){};if(f===0){return this}this.each(function(){d.setBearing.apply(a(this),[a(this).data("roundabout").bearing+f])});e.apply(this);return this},setTilt:function(f,e){e=e||function(){};this.each(function(){a(this).data("roundabout").tilt=f;d.updateChildren.apply(a(this))});e.apply(this);return this},adjustTilt:function(f,e){e=e||function(){};this.each(function(){d.setTilt.apply(a(this),[a(this).data("roundabout").tilt+f])});e.apply(this);return this},animateToBearing:function(e,g,h,j,f){var i=(new Date()).getTime();f=f||function(){};if(a.isFunction(j)){f=j;j=null}else{if(a.isFunction(h)){f=h;h=null}else{if(a.isFunction(g)){f=g;g=null}}}this.each(function(){var q,l,m,n=a(this),k=n.data("roundabout"),o=(!g)?k.duration:g,p=(h)?h:k.easing||"swing";if(!j){j={timerStart:i,start:k.bearing,totalTime:o}}q=i-j.timerStart;if(k.stopAnimation){d.allowAnimation.apply(n);k.animating=false;return}if(q<o){if(!k.animating){n.trigger("animationStart")}k.animating=true;if(typeof a.easing.def==="string"){l=a.easing[p]||a.easing[a.easing.def];m=l(null,q,j.start,e-j.start,j.totalTime)}else{m=a.easing[p]((q/j.totalTime),q,j.start,e-j.start,j.totalTime)}if(d.compareVersions.apply(null,[a().jquery,"1.7.2"])>=0&&!(a.easing.easeOutBack)){m=j.start+((e-j.start)*m)}m=d.normalize.apply(null,[m]);k.dragBearing=m;d.setBearing.apply(n,[m,function(){setTimeout(function(){d.animateToBearing.apply(n,[e,o,p,j,f])},0)}])}else{k.lastAnimationStep=true;e=d.normalize.apply(null,[e]);d.setBearing.apply(n,[e,function(){n.trigger("animationEnd")}]);k.animating=false;k.lastAnimationStep=false;k.dragBearing=e;f.apply(n)}});return this},animateToNearbyChild:function(h,i){var f=h[0],g=h[1],e=h[2]||function(){};if(a.isFunction(g)){e=g;g=null}else{if(a.isFunction(f)){e=f;f=null}}return this.each(function(){var m,o,p=a(this),l=p.data("roundabout"),k=(!l.reflect)?l.bearing%360:l.bearing,n=p.children(l.childSelector).length;if(!l.animating){if((l.reflect&&i==="previous")||(!l.reflect&&i==="next")){k=(Math.abs(k)<l.floatComparisonThreshold)?360:k;for(m=0;m<n;m+=1){o={lower:(l.period*m),upper:(l.period*(m+1))};o.upper=(m===n-1)?360:o.upper;if(k<=Math.ceil(o.upper)&&k>=Math.floor(o.lower)){if(n===2&&k===360){d.animateToDelta.apply(p,[-180,f,g,e])}else{d.animateBearingToFocus.apply(p,[o.lower,f,g,e])}break}}}else{k=(Math.abs(k)<l.floatComparisonThreshold||360-Math.abs(k)<l.floatComparisonThreshold)?0:k;for(m=n-1;m>=0;m-=1){o={lower:l.period*m,upper:l.period*(m+1)};o.upper=(m===n-1)?360:o.upper;if(k>=Math.floor(o.lower)&&k<Math.ceil(o.upper)){if(n===2&&k===360){d.animateToDelta.apply(p,[180,f,g,e])}else{d.animateBearingToFocus.apply(p,[o.upper,f,g,e])}break}}}}})},animateToNearestChild:function(f,g,e){e=e||function(){};if(a.isFunction(g)){e=g;g=null}else{if(a.isFunction(f)){e=f;f=null}}return this.each(function(){var h=d.getNearestChild.apply(a(this));d.animateToChild.apply(a(this),[h,f,g,e])})},animateToChild:function(f,g,h,e){e=e||function(){};if(a.isFunction(h)){e=h;h=null}else{if(a.isFunction(g)){e=g;g=null}}return this.each(function(){var i,k=a(this),j=k.data("roundabout");if(j.childInFocus!==f&&!j.animating){i=k.children(j.childSelector).eq(f);d.animateBearingToFocus.apply(k,[i.data("roundabout").degrees,g,h,e])}})},animateToNextChild:function(f,g,e){return d.animateToNearbyChild.apply(this,[arguments,"next"])},animateToPreviousChild:function(f,g,e){return d.animateToNearbyChild.apply(this,[arguments,"previous"])},animateToDelta:function(f,g,h,e){e=e||function(){};if(a.isFunction(h)){e=h;h=null}else{if(a.isFunction(g)){e=g;g=null}}return this.each(function(){var i=a(this).data("roundabout").bearing+f;d.animateToBearing.apply(a(this),[i,g,h,e])})},animateBearingToFocus:function(f,g,h,e){e=e||function(){};if(a.isFunction(h)){e=h;h=null}else{if(a.isFunction(g)){e=g;g=null}}return this.each(function(){var i=a(this).data("roundabout").bearing-f;i=(Math.abs(360-i)<Math.abs(i))?360-i:-i;i=(i>180)?-(360-i):i;if(i!==0){d.animateToDelta.apply(a(this),[i,g,h,e])}})},stopAnimation:function(){return this.each(function(){a(this).data("roundabout").stopAnimation=true})},allowAnimation:function(){return this.each(function(){a(this).data("roundabout").stopAnimation=false})},startAutoplay:function(e){return this.each(function(){var g=a(this),f=g.data("roundabout");e=e||f.autoplayCallback||function(){};clearInterval(f.autoplayInterval);f.autoplayInterval=setInterval(function(){d.animateToNextChild.apply(g,[e])},f.autoplayDuration);f.autoplayIsRunning=true;g.trigger("autoplayStart")})},stopAutoplay:function(e){return this.each(function(){clearInterval(a(this).data("roundabout").autoplayInterval);a(this).data("roundabout").autoplayInterval=null;a(this).data("roundabout").autoplayIsRunning=false;if(!e){a(this).unbind(".autoplay")}a(this).trigger("autoplayStop")})},toggleAutoplay:function(e){return this.each(function(){var g=a(this),f=g.data("roundabout");e=e||f.autoplayCallback||function(){};if(!d.isAutoplaying.apply(a(this))){d.startAutoplay.apply(a(this),[e])}else{d.stopAutoplay.apply(a(this),[e])}})},isAutoplaying:function(){return(this.data("roundabout").autoplayIsRunning)},changeAutoplayDuration:function(e){return this.each(function(){var g=a(this),f=g.data("roundabout");f.autoplayDuration=e;if(d.isAutoplaying.apply(g)){d.stopAutoplay.apply(g);setTimeout(function(){d.startAutoplay.apply(g)},10)}})},normalize:function(e){var f=e%360;return(f<0)?360+f:f},normalizeRad:function(e){while(e<0){e+=(Math.PI*2)}while(e>(Math.PI*2)){e-=(Math.PI*2)}return e},isChildBackDegreesBetween:function(f,g){var e=a(this).data("roundabout").backDegrees;if(f>g){return(e>=g&&e<f)}else{return(e<g&&e>=f)}},getAnimateToMethod:function(e){e=e.toLowerCase();if(e==="next"){return"animateToNextChild"}else{if(e==="previous"){return"animateToPreviousChild"}}return"animateToNearestChild"},relayoutChildren:function(){return this.each(function(){var e=a(this),f=a.extend({},e.data("roundabout"));f.startingChild=e.data("roundabout").childInFocus;d.init.apply(e,[f,null,true])})},getNearestChild:function(){var g=a(this),e=g.data("roundabout"),f=g.children(e.childSelector).length;if(!e.reflect){return((f)-(Math.round(e.bearing/e.period)%f))%f}else{return(Math.round(e.bearing/e.period)%f)}},degToRad:function(e){return d.normalize.apply(null,[e])*Math.PI/180},getPlacement:function(e){var f=this.data("roundabout");return(!f.reflect)?360-(f.period*e):f.period*e},isInFocus:function(g){var h,i=this,f=i.data("roundabout"),e=d.normalize.apply(null,[f.bearing]);g=d.normalize.apply(null,[g]);h=Math.abs(e-g);return(h<=f.floatComparisonThreshold||h>=360-f.floatComparisonThreshold)},getChildInFocus:function(){var e=a(this).data("roundabout");return(e.childInFocus>-1)?e.childInFocus:false},compareVersions:function(f,h){var j,e=f.split(/\./i),g=h.split(/\./i),k=(e.length>g.length)?e.length:g.length;for(j=0;j<=k;j++){if(e[j]&&!g[j]&&parseInt(e[j],10)!==0){return 1}else{if(g[j]&&!e[j]&&parseInt(g[j],10)!==0){return -1}else{if(e[j]===g[j]){continue}}}if(e[j]&&g[j]){if(parseInt(e[j],10)>parseInt(g[j],10)){return 1}else{return -1}}}return 0}};a.fn.roundabout=function(e){if(d[e]){return d[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||a.isFunction(e)||!e){return d.init.apply(this,arguments)}else{a.error("Method "+e+" does not exist for jQuery.roundabout.")}}}})(jQuery);